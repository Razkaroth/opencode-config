use flake .

# Secret discovery with find_up
SECRETS_FILE=$(find_up secrets.env)
if [[ -f "$SECRETS_FILE" ]]; then
  dotenv "$SECRETS_FILE"
else
  log_error "secrets.env not found in current or parent directories"
  exit 1
fi

# Port offset calculation
WORKTREE_ID=$(basename "$PWD")
if [[ "$PWD" == *"/.git/worktrees/"* ]]; then
  PORT_OFFSET=$(echo -n "$WORKTREE_ID" | cksum | cut -d' ' -f1)
  PORT_OFFSET=$((PORT_OFFSET % 50 + 1))
  export COMPOSE_PROJECT_NAME="opencode_${WORKTREE_ID}"
else
  PORT_OFFSET=0
  export COMPOSE_PROJECT_NAME="nordic_starter"
fi

# Export all port variables
export APP_PORT=$((3000 + PORT_OFFSET))
export MONGO_PORT=$((27017 + PORT_OFFSET))
export MINIO_PORT=$((9000 + PORT_OFFSET))
export MINIO_CONSOLE_PORT=$((9001 + PORT_OFFSET))
export MINIO_TEST_PORT=$((9002 + PORT_OFFSET))
export MINIO_TEST_CONSOLE_PORT=$((9003 + PORT_OFFSET))
export STORYBOOK_PORT=$((6006 + PORT_OFFSET))
export PLAYWRIGHT_PORT=$((8008 + PORT_OFFSET))
export EMAIL_PORT=$((3001 + PORT_OFFSET))

# Database
export DATABASE_MONGODB_URI="mongodb://localhost:${MONGO_PORT}/nordic-starter"

# S3/MinIO
export S3_ACCESS_KEY_ID=minio
export S3_ENDPOINT="http://localhost:${MINIO_PORT}"
export S3_REGION=us-east-1
export S3_BUCKET=forge

# Clerk
export CLERK_JWT_ISSUER_DOMAIN=https://comic-hippo-56.clerk.accounts.dev
export NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_Y29taWMtaGlwcG8tNTYuY2xlcmsuYWNjb3VudHMuZGV2JA
export NEXT_PUBLIC_CLERK_SIGN_IN_URL=/acceso
export NEXT_PUBLIC_CLERK_SIGN_UP_URL=/acceso

# Stripe
export NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_51Qe4864KPQ7wVLGTXiif5pAOqmcw6VWAtNYn0RnnwUYx3ubjirrjyBKmfPU086f4AhbKHnuaDNK7U13o2x1L3d8p00vuAolf3Z

# Email
export SMTP_HOST=smtp.ethereal.email
export SMTP_PORT=587
export SMTP_USER=dorcas31@ethereal.email
export EMAIL_FROM_ADDRESS=dorcas31@ethereal.email
export EMAIL_FROM_NAME=Nordic Studio

# Next.js
export NEXT_PUBLIC_SERVER_URL="http://localhost:${APP_PORT}"

# Convex
export CONVEX_DEPLOYMENT=anonymous:anonymous-starter
export NEXT_PUBLIC_CONVEX_URL=http://127.0.0.1:3210

# Developer
export DEVELOPER=raz
